% Generated by roxygen2: do not edit by hand
% Please edit documentation in R/simulate_ebrel_spatial_data.R
\name{simulate_ebrel_spatial_data}
\alias{simulate_ebrel_spatial_data}
\title{Simulate spatial habitat and species distribution data for EBREL}
\usage{
simulate_ebrel_spatial_data(
  dim_x,
  dim_y,
  n_h,
  n_s,
  disp_max,
  disp_longtail = 0.5,
  rarity_bias = 1,
  fixed_O = NULL,
  maskLandArea = FALSE,
  prop_sea = 0.2,
  convert_to_cpp_format = TRUE,
  seed = NULL
)
}
\arguments{
\item{dim_x}{Integer. Number of rows in the spatial grid (e.g. x/easting).}

\item{dim_y}{Integer. Number of columns in the spatial grid (e.g. y/northing).}

\item{n_h}{Integer. Number of distinct habitat types (the last type is treated
as non-selectable/urban in the cost construction).}

\item{n_s}{Integer. Number of species.}

\item{disp_max}{Integer. Maximum allowable dispersal distance (in cells) for
species. Gamma-drawn distances are truncated at this value.}

\item{disp_longtail}{Integer (0–3). Dispersal long-tail class passed to
\code{.map_longtail_to_gamma()}. Controls the typical mean and spread of
species' dispersal distances relative to grid size:
\itemize{
\item \code{0}: very short-tailed dispersal
\item \code{1}: short-tailed dispersal
\item \code{2}: intermediate dispersal
\item \code{3}: long-tailed (more long-distance dispersers)
}
Larger values yield species with, on average, longer and more variable
dispersal distances. (See \code{.map_longtail_to_gamma()} for exact mapping.)}

\item{rarity_bias}{Numeric (≥0). Controls how many species are rare
(low-prevalence). A value of \code{0} produces more equal prevalence across
species; higher values (e.g. 1–3) generate more strongly right-skewed
prevalence distributions, with many rare species. Implemented via a
Beta-distributed rarity weight.}

\item{fixed_O}{Optional numeric (>0). If supplied, applies the same occupancy
target (proportional increase in occupancy) to all species. If \code{NULL},
species-specific occupancy targets are drawn at random.}

\item{maskLandArea}{Logical. If \code{TRUE}, habitat and species layers are
masked to the land area defined by the internally generated land mask.
If \code{FALSE}, the land mask is still generated but returned as a separate
layer and not used to mask habitat or species.}

\item{prop_sea}{Numeric in \eqn{(0, 1)}. Proportion of the grid height that
can be occupied by sea when generating the land–sea mask. Passed to the
internal coastline/land-mask generator.}

\item{convert_to_cpp_format}{Logical. If \code{TRUE} (default), returns data
converted into the vector/matrix formats required by the EBREL C++ code via
\code{prepare_ebrel_r_to_cpp()}. If \code{FALSE}, returns higher-level R
objects (mostly \code{SpatRaster}s and matrices) suitable for inspection
and further manipulation in R.}

\item{seed}{Optional integer. If provided, used to seed the random number
generator to make results reproducible.}
}
\value{
If \code{convert_to_cpp_format = FALSE}, returns a list:
\describe{
\item{\code{dim_x}}{Number of rows.}
\item{\code{dim_y}}{Number of columns.}
\item{\code{n_h}}{Number of habitat types.}
\item{\code{n_s}}{Number of species.}
\item{\code{E}}{\code{SpatRaster} with \code{n_h} layers of binary habitat
(0/1) after handling NAs/unavailable cells.}
\item{\code{C}}{\code{SpatRaster} with \code{n_h} layers of habitat conversion
costs (large values for unavailable/urban).}
\item{\code{SD}}{\code{SpatRaster} with \code{n_s} layers of binary species
presence/absence.}
\item{\code{SxH}}{Matrix \code{[n_s, n_h]} indicating which species use which
habitats (1 = used, 0 = not used).}
\item{\code{D}}{Numeric vector of length \code{n_s} giving species dispersal
distances (in cells) after truncation by \code{disp_max}.}
\item{\code{O}}{Numeric vector of length \code{n_s} of species occupancy
targets.}
\item{\code{sigma}}{Scalar penalty weight based on the mean dispersal distance
(\code{1 / mean(D)}).}
\item{\code{LM}}{\code{SpatRaster} land mask (1 = land, 0 = non-land/sea).}
}

If \code{convert_to_cpp_format = TRUE}, returns the list produced by
\code{prepare_ebrel_r_to_cpp()}, containing the same information restructured
into simple vectors/matrices suitable for passing directly to the EBREL C++
optimisation routines (see \code{prepare_ebrel_r_to_cpp()} for details).
}
\description{
Generates virtual habitat configurations, land–sea masks, conversion costs,
and species distributions for testing spatial conservation and species
distribution models. The simulation supports scalable grid dimensions,
flexible numbers of habitats and species, grid-scaled species dispersal
distances drawn from a Gamma distribution, and a tunable proportion of
rare (low-prevalence) species.
}
\details{
Habitat is generated as autocorrelated raster layers, optionally overlaid
with a simple land–sea mask. Species are assigned to one or more habitat
types, seeded into suitable cells, and their ranges are grown using a
breadth-first search constrained by habitat and species-specific dispersal
distances. Dispersal distances are drawn from a Gamma distribution whose
mean and variance are scaled to the grid dimension \code{dim_x} and
controlled by a discrete long-tail class (see \code{disp_longtail} and
\code{.map_longtail_to_gamma()}).
}
\examples{
\dontrun{
# Basic example with 3 habitats and 15 species on a 50x50 grid
sim <- simulate_ebrel_spatial_data(
  dim_x = 50, dim_y = 50,
  n_h = 3, n_s = 15,
  disp_max = 20,
  rarity_bias = 2,
  convert_to_cpp_format = FALSE,
  seed = 123
)

# Dispersal distances
hist(sim$D, main = "Species dispersal distances")

# Plot first habitat layer
plot(sim$E[[1]], main = "Habitat 1")

# Average prevalence per species
avg_prev <- mean(global(sim$SD, fun = "sum", na.rm = TRUE)) / (50 * 50)
avg_prev
}

}
